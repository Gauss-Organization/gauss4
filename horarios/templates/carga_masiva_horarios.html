{% extends "base.html" %}
{% load my_templatetags %}

{% block contenido %}
    <form action="" method="post" enctype="multipart/form-data" id="{{ formname }}" name="{{ formname }}">
        {% csrf_token %}

        <div class="">
            <h4 style="text-align: center;color: #008CBA;"><strong> Carga masiva de datos de horarios</strong></h4>
        </div>

        <input type="hidden" name="action" value="carga_masiva_racima_xml">
        <div class="panel callout">
            <div class="row">
                <div class="large-4 columns">
                    <b>Archivo xml (Racima y Peñalara):</b>
                </div>
                <div class="large-8 columns">
                    <input type="file" name="file_masivo" id="file_masivo"/></strong>
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="large-12 columns">
                    <p>Este formulario sirve para cargar dos archivos diferentes:</p>
                    <ol>
                        <li><b>El primero se obtiene de:</b>
                            Racima <i class="fa fa-long-arrow-right"></i> Utilidades
                            <i class="fa fa-long-arrow-right"></i> Intercambios de información
                            <i class="fa fa-long-arrow-right"></i> Exportar datos desde Gestión de Centros
                            <i class="fa fa-long-arrow-right"></i> Exportación hacia generadores de horarios
                        </li>
                        <li><b>El segundo de:</b>
                            Peñalara <i class="fa fa-long-arrow-right"></i> Exportar
                            <i class="fa fa-long-arrow-right"></i> Plumier
                        </li>
                    </ol>
                    <p><i>GAUSS distinguirá automáticamente uno de otro.</i></p>
                </div>
            </div>
        </div>
        {% if 'especialidades' in incidencias %}
            {{ incidencias.especialidades }}
        {% endif %}
    </form>

{% endblock %}


{% block final %}
    <script>

        habilita(['s_check']);
        $('#check_sign').click(function (e) {
            e.preventDefault();
            if ($('#file_masivo').val()) {
                document.{{formname}}.submit();
            } else {
                show_mensajes({
                    title: '<i class="fa fa-warning"></i> No has cargado un archivo', texto: 'Para ' +
                    'subir un archivo primero debes cargarlo pulsando en "Examinar..."'
                })
            }
        });

        $('body').on('change', '.especialidad', function () {
            var gep = $(this).data('id');
            var especialidad = $(this).val();
            $.post("/carga_masiva_horarios/", {action: 'update_especialidad', gep: gep, especialidad: especialidad},
                function (data) {
                    if (data.ok) {
                        $("#update_ok").show().delay(1500).fadeOut();
                    } else {
                        $("#update_error").show().delay(1500).fadeOut();
                    }
                });
        });

        $('body').on('change', '.departamento', function () {
            var gep = $(this).data('id');
            var departamento = $(this).val();
            $.post("/carga_masiva_horarios/", {action: 'update_departamento', gep: gep, departamento: departamento},
                function (data) {
                    if (data.ok) {
                        $("#update_ok").show().delay(1500).fadeOut();
                    } else {
                        $("#update_error").show().delay(1500).fadeOut();
                    }
                });
        });



    </script>
{% endblock %}