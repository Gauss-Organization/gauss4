{% extends "lateral.html" %}
{% load my_templatetags %}

{% block head %}
<link rel="stylesheet" type="text/css" href="/static/js/CLEditor1_4_3/jquery.cleditor.css" />
<script type="text/javascript" src="/static/js/CLEditor1_4_3/jquery.cleditor.min.js"></script>
<style>
  li { margin-left:25px; }
</style>
{% endblock %}


{% block ready %}
  {% if puede_crear_convocatoria %}
    visualizar(['plus_sign']);
    $( "#plus_sign" ).removeClass('no_navegar').addClass('navegar').attr('title','Crear una nueva convocatoria');
  {% endif %}

  $.cleditor.defaultOptions.controls = "bold underline italic strikethrough | bullets numbering  | undo redo";
  
  $('#plus_sign').click(function () { if( $(this).hasClass('navegar') ) {
    window.location = "/crear_convocatoria/"; }});

  $('.edit_convocatoria').click(function () {  
    var id = this.id.split('___')[1];
    window.location = "/editar_convocatoria/?con="+id;});
  
  $('.delete_convocatoria').click(function () {  
    $('#action').val('del_convocatoria');
    var id = this.id.split('___')[1];
    $('#id_convocatoria').val(id);
    $( "#dialog_del_convocatoria" ).dialog({width: 'auto', modal: true, buttons: {
	  "Continuar": function() { $( this ).dialog( "close" ); document.{{formname}}.submit();},
	  "Cancelar": function() { $( this ).dialog( "close" ); }}});});

  $(".pdf_convocatoria").click(function() {
      var id = this.id.split('___')[1];
      $('#id_convocatoria').val(id);
      $('#action').val('pdf_convocatoria');
      document.{{formname}}.submit();});

  $(".copy_convocatoria").click(function() {
      var id = this.id.split('___')[1];
      $('#id_convocatoria').val(id);
      $('#action').val('copy_convocatoria');
      document.{{formname}}.submit();});

  $('#ok_sign').click(function () {  if( $(this).hasClass('navegar') ) {
      $('#action').val('guardar');
      $('#id_texto').val(removeWordTags ($('#id_texto').val())); 
      document.{{formname}}.submit();}});


  $(".ver_convocatoria").click(function() {
      id = this.id.split('___')[1];
      if ($('#contenido_'+id).text()){
	$('#contenido_'+id).toggle();
      }else{
	$.post("/contenido_convocatoria/", {id_convocatoria:JSON.stringify(id),},function(data) {
	    $('#contenido_'+id).html(data);
	    $('#ver_convocatoria_'+id).hide();});}});

  
{% endblock %}


{% block navegar %}                                                     
{% endblock %}


{% block contenido %}
<form action="" method="post" enctype="multipart/form-data" id="{{formname}}" name="{{formname}}">
{% csrf_token %}
<input type="hidden" id="action" name="action" value="">
<input type="hidden" id="id_convocatoria" name="id_convocatoria" value="">

<div id="div_convocatorias">
  <table align="center" width="100%" cellspacing="3" cellpadding="3">
    <tr > <td class="cabecera" colspan="2">
    <div style="float:center;text-align:center;">
      &nbsp;&nbsp;Convocatorias de reunión en las que has recibido
    </div><td></tr>
    {% for convocatoria in convocatorias %}
      <tr style="font-size:10pt;"> <td>&nbsp;</td></tr>
      <tr style="font-size:10pt;" class="convocatoria_description___{{convocatoria.id}}"> <td style="border-bottom:3px solid lightgray;">
	<div style="float:left;">
	  &nbsp;&nbsp;Convocatoria de {{convocatoria.get_tipo_display}} para el {{convocatoria.fecha_hora|date:"d-m-Y"}} a las {{convocatoria.fecha_hora|date:"H:i"}}
	</div>
	<div class="ver_convocatoria" id="ver_convocatoria___{{convocatoria.id}}">
	  <i class="icon-eye-open" title="Ver el texto de esta convocatoria"></i>
	</div>
	<div class="pdf_convocatoria" id="pdf_convocatoria___{{convocatoria.id}}">
	  <i class="icon-file-text-alt" title="Generar pdf de esta convocatoria"></i>
	</div>
	{% if convocatoria.convocante == request.session.gauser_extra %}
	<div class="copy_convocatoria" id="copy_convocatoria___{{convocatoria.id}}">
	  <i class="icon-copy" title="Hacer copia de esta convocatoria"></i>
	</div>
	<div class="edit_convocatoria" id="edit_convocatoria___{{convocatoria.id}}">
	  <i class="icon-edit" title="Editar esta convocatoria"></i>
	</div>
	<div class="delete_convocatoria" id="del_convocatoria___{{convocatoria.id}}">
	  <i class="icon-trash" title="Borrar esta convocatoria"></i>
	</div>
	{% endif %}
      <td></tr>
      <tr class="convocatoria_description___{{convocatoria.id}}">
      <td width="100%" style="white-space:normal;">
	<div id="contenido_{{convocatoria.id}}" title="Contenido del convocatoria" style="margin-left:25px;"></div>
      </td></tr>
    {% endfor %}
  </table>
</div>
</form>

<div id="dialog_del_convocatoria" title="Eliminar este convocatoria" style="display:none;">
  <p><i class="icon-warning-sign"></i> Tras esta acción la convocatoria se eliminará completamente de la base de datos.</p><p>¿Seguro que quieres continuar?</p>
</div>

{% endblock %}
