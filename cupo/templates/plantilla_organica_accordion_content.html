{% load entidades_extras %}
{% load cupo_extras %}
<div class="row">
    <div class="columns large-12">
        <ul class="button-group right">
            <li><a class="button alert borrar_po tiny" data-id="{{ po.id }}"
                   title="Borrar completamente este estudio de plantilla orgánica"><i class="fa fa-trash-o"></i>
                Borrar</a></li>
            <li><a class="button copiar_po tiny" data-id="{{ po.id }}"
                   title="Hacer una copia (un duplicado) de este estudio"><i class="fa fa-copy"></i> Copiar</a>
            </li>
            <li><a class="button excel_po tiny" data-id="{{ po.id }}"
                   title="Crear un EXCEL de este estudio de plantilla"><i class="fa fa-file-excel-o"></i> EXCEL</a>
            </li>
        </ul>
    </div>
</div>
{% if g_e|has_permiso:'carga_plantillas_por_funciones' %}
    <div class="row">
        <div class="columns large-12">
            <ul class="button-group right">
                <li><a class="button info plantilla_funcion tiny" data-po="{{ po.id }}"
                       data-funcion="carga_dependencias">
                    Carga dependencias</a></li>
                <li><a class="button info plantilla_funcion tiny" data-po="{{ po.id }}" data-funcion="carga_etapas">
                    Carga etapas</a></li>
                <li><a class="button info plantilla_funcion tiny" data-po="{{ po.id }}" data-funcion="carga_cursos">
                    Carga cursos</a></li>
                <li><a class="button info plantilla_funcion tiny" data-po="{{ po.id }}" data-funcion="carga_grupos">
                    Carga grupos</a></li>
                <li><a class="button info plantilla_funcion tiny" data-po="{{ po.id }}" data-funcion="carga_materias">
                    Carga materias</a></li>
                <li><a class="button info plantilla_funcion tiny" data-po="{{ po.id }}"
                       data-funcion="carga_departamentos">
                    Carga departamentos</a></li>
                <li><a class="button info plantilla_funcion tiny" data-po="{{ po.id }}" data-funcion="carga_puestos">
                    Carga puestos</a></li>
                <li><a class="button info plantilla_funcion tiny" data-po="{{ po.id }}"
                       data-funcion="carga_actividades">
                    Carga actividades</a></li>
                <li><a class="button info plantilla_funcion tiny" data-po="{{ po.id }}" data-funcion="carga_docentes">
                    Carga docentes</a></li>
                <li><a class="button info plantilla_funcion tiny" data-po="{{ po.id }}"
                       data-funcion="carga_sesiones_docentes">
                    Carga sesiones</a></li>
                <li><a class="button info plantilla_funcion tiny" data-po="{{ po.id }}" data-funcion="carga_pdocentes">
                    Carga plantilla</a></li>
            </ul>
        </div>
    </div>
{% endif %}

<table style="width: 100%;position: relative;">
    <thead id="cabecera_tabla_vacantes">
    <tr>
        <th colspan="7" style="color: #1b75bb;text-align: center;width: {{ po.anchura_cols.0 }}%;">Plazas de plantilla
            orgánica actualizadas a {{ po|get_fecha_plazas }}</th>
    </tr>
    <tr>
        <th>Especialidad</th>
        <th>Cuerpo</th>
        <th>Código</th>
        <th>Tipo</th>
        <th>Plazas</th>
        <th>Ocupadas</th>
        <th>Vacantes</th>
    </tr>
    </thead>
    <tbody>
    {% for plaza in po|get_plazas %}
        <tr>
            <td>{{ plaza.nombre }}</td>
            <td>{{ plaza.cod_cuerpo }}</td>
            <td>{{ plaza.cod_especialidad }}</td>
            <td {% if plaza.tipo == 'ord' %}title="Plaza ordinaria"
                {% elif plaza.tipo == 'com' %}title="Plaza compartida con otros centros de la misma localidad"
                {% elif plaza.tipo == 'iti' %}title="Plaza con carácter itinerante entre diferentes localidades"
                {% else %}title="Plaza bilingüe"{% endif %}>{{ plaza.get_tipo_display }}</td>
            <td>{{ plaza.plazas }}</td>
            <td>{{ plaza.ocupadas }}</td>
            <td>{{ plaza.vacantes }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>

{% if po.carga_completa %}
    <table style="width: 100%;position: relative;table-layout: fixed;">
        <thead id="cabecera_tabla_po">
        <tr>
            <th style="color: #1b75bb;text-align: center;width: {{ po.anchura_cols.0 }}%;" colspan="2">Especialidades y
                Docentes
            </th>
            {% for apartado in po|get_apartados %}
                <th style="color: #1b75bb;text-align: center;width: {{ apartado.width }}%"
                    colspan="{{ apartado.colspan }}">
                    {{ apartado.nombre }}
                </th>
            {% endfor %}
            <th style="color: #1b75bb;text-align: center;width: {{ po.anchura_cols.2 }}%;" colspan="3">Horas
                calculadas
            </th>
        </tr>
        </thead>
        <tbody id="tbody_docente{{ po.id }}">
        {% include "plantilla_organica_accordion_content_tbody.html" %}
        </tbody>
    </table>

    <label for="select_grupoex{{ po.id }}">
        Selecciona los grupos que no se deben tener en cuenta para el cálculo de plantilla:</label>
    <div id="lista_grupoex{{ po.id }}">
        {% include "plantilla_organica_accordion_content_gruposexcluidos.html" %}
    </div>
    <select class="select_grupoex" id="select_grupoex{{ po.id }}">
        {% for grupo in po|get_grupos %}
            <option value="{{ grupo.id }}">
                {{ grupo.nombre }} --
                {% for curso in grupo.cursos.all %}
                    {{ curso.nombre }}
                    {% if not forloop.last %}-{% endif %}
                {% endfor %}</option>
        {% endfor %}
    </select>
    <script>
        $('#select_grupoex{{ po.id }}').select2();
    </script>
    {#    <div class="row">#}
    {#    <div class="columns-12">#}
    <label>Selecciona la especialidad que quieres analizar:
        <select class="especialidad_docente" id="especialidad_docente{{ po.id }}">
            <option value="">-----------</option>
            {% for edb in po.ronda_centro.especialidaddocentebasica_set.all %}
                <option value="{{ edb.id }}">{{ edb.puesto }}</option>
            {% endfor %}
        </select>
    </label>
    {#    </div>#}
    {#    </div>#}
    {#    <div id="materias_edb{{ po.id }}">#}
    {#{% include "plantilla_organica_accordion_content_materias_edb.html" %}#}
    {#    </div>#}
    <hr>
    <table style="width: 100%">
        <thead>
        <tr>
            <th colspan="12" style="text-align: center"><b>Estudio de los apoyos en Primaria
                ({{ po.ronda_centro.entidad.name }})</b></th>
        </tr>
        <tr>
            <th>&nbsp;</th>
            {# La primera columna está destinada a los grupos #}
            <th>LCL</th>
            {# 168607 170306 168625 170325 168644 170344 #}
            <th>LCRM</th>
            {# 168606 170305 168624 170324 168643 170343 #}
            <th>Matem.</th>
            {# 168608 170307 168626 170326 168645 170345 #}
            <th>CCSS</th>
            {# 168604 170303 168622 170322 168641 170341 #}
            <th>CCNN</th>
            {# 168605 170304 168623 170323 168642 170342 #}
            <th>Inglés</th>
            {# 168615 170314 168633 170333 168652 170352 #}
            <th>EF</th>
            {# 168612 170311 168630 170330 168649 170349 #}
            <th>Música</th>
            {# 168610 170309 168628 170328 168647 170347 #}
            <th>Plástica</th>
            {# 168611 170310 168629 170329 168648 170348 #}
            <th>Valores</th>
            {# 168660 170321 168640 170340 168659 170359 #}
            <th title="Número total de apoyos por grupo">Apoyos</th>
        </tr>
        </thead>
        {% for grupo_dic in po|get_apoyos %}
            <tr>
                {% for td_key, td_value in grupo_dic.items %}
                    {% if forloop.first %}
                        <td><b>{{ td_value.nombre }}</b></td>
                    {% elif forloop.last %}
                        <td class="num_apoyos_grupo{{ po.id }}" style="font-weight: bold;">{{ td_value }}</td>
                    {% else %}
                        <td title="
                                {% for s in td_value %}{{ s.sesion.g_e.gauser.get_full_name }} - {{ s.sesion.g_e.puesto }}&#10;{% endfor %}">{{ td_value|length }}</td>
                    {% endif %}
                {% endfor %}
            </tr>
        {% endfor %}
        <tr>
            <td colspan="11" style="text-align: right;font-weight: bold;">Número total de apoyos en Primaria:</td>
            <td id="num_apoyos_total{{ po.id }}" style="font-weight: bold;"></td>
        </tr>
    </table>
{% else %}
    <h4 style="text-align: center;color: #008CBA;"><strong>Cargando la información
        <i class="fa fa-spinner fa-pulse fa-2x"></i></strong></h4>
    <h5 style="text-align: center;color: #008CBA;"><strong>Este proceso puede requerir de varios minutos.</strong></h5>
    <h5 style="text-align: center;color: #008CBA;"><strong>Cierra este "acordeón" y vuélvelo a abrir en un
        rato.</strong></h5>
{% endif %}

<script>
    setTimeout(function () {
        var suma = 0;
        $('.num_apoyos_grupo{{ po.id }}').each(function () {
            suma += parseFloat($(this).text());
        });
        $('#num_apoyos_total{{ po.id }}').html(suma);
    }, 300);
</script>